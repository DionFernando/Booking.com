<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Lists | Booking.com</title>
    <!-- Font Awesome (Optional for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          integrity="sha512-p1BmXzYeX1hUq2xXK1n4eoVe6ja6eic+s4svHu50E+Ee+mCcpSwQzAujGa7J5j2dF5N4Ybzh1H+fU40Qw2Jfiw=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" href="../assets/icons/booking.com-icon.png" type="image/x-icon" />
    <style>
        /* Global Styles */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            color: #333;
        }
        a {
            text-decoration: none;
            color: inherit;
        }
        /* Header */
        .header {
            background-color: #003580;
            color: #fff;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
        }
        .logo {
            height: 60px;
            margin-left: 50px;
        }
        .user-actions {
            display: flex;
            align-items: center;
            margin-right: 50px;
            gap: 10px;
            position: relative;
        }
        .user-profile {
            display: flex;
            align-items: center;
            padding: 5px 8px;
            border-radius: 10px;
            cursor: pointer;
        }
        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #eb8934;
        }
        .user-profile .user-details {
            display: flex;
            flex-direction: column;
        }
        .user-profile .username {
            font-size: 0.95rem;
            color: #fff;
            font-weight: 600;
        }
        .user-profile .genius-level {
            font-size: 0.8rem;
            color: #eb8934;
            font-weight: 400;
        }
        header .description {
            font-size: 1rem;
            margin-left: 15px;
            opacity: 0.9;
        }
        /* After Header Section */
        .after-header {
            border: 1px solid #003580;
            background-color: #003580;
            color: #fff;
            padding: 10px 0;
        }
        .your-lists-h2 {
            margin-left: 60px;
            font-size: 1.6rem;
        }
        .after-header .description {
            margin-left: 60px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        /* Main Content Container */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        /* Section Titles */
        .section-title {
            font-size: 1.5rem;
            color: #003580;
            margin: 40px 0 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 8px;
            display: flex;
            align-items: center;
        }
        .section-title img {
            width: 30px;
            margin-right: 10px;
        }
        /* List Card Layout */
        .list-card {
            display: flex;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }
        .list-card-img {
            flex: 0 0 300px;
        }
        .list-card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px 0 0 8px;
        }
        .list-card-details {
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            /* Ensures the buttons container aligns at the bottom */
        }
        .list-card-details h3 {
            margin: 0 0 8px;
            font-size: 1.2rem;
            color: #003580;
        }
        .list-card-details p {
            margin: 4px 0;
            font-size: 0.95rem;
            color: #555;
        }
        .edit-button,
        .delete-button {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            transition: background-color 0.3s ease;
        }
        .edit-button {
            background-color: #003580;
            color: #fff;
        }
        .edit-button:hover {
            background-color: #005999;
        }
        .delete-button {
            background-color: #d32f2f;
            color: #fff;
        }
        .delete-button:hover {
            background-color: #b71c1c;
        }
        /* Action Buttons Container */
        .action-buttons {
            margin-top: auto; /* Pushes the container to the bottom */
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        /* Placeholder Message */
        .placeholder {
            text-align: center;
            margin: 40px 0;
            color: #777;
            font-size: 0.9rem;
        }
        /* Call-to-Action Button */
        .cta-button {
            display: inline-block;
            background-color: #003580;
            color: #fff;
            padding: 12px 40px;
            border-radius: 6px;
            font-size: 0.8rem;
            margin: 20px auto;
            transition: background-color 0.3s;
            cursor: pointer;
            text-align: center;
        }
        .cta-button:hover {
            background-color: #005999;
        }
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }
            header .description {
                margin-left: 0;
                margin-top: 10px;
            }
            .list-card {
                flex-direction: column;
            }
            .list-card-img {
                width: 100%;
            }
            .list-card-img img {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>

<!-- Header -->
<header class="header">
    <div class="top-bar">
        <img src="../assets/icons/bookinglogowhite.png" alt="Booking.com Logo" class="logo" />
        <div class="user-actions">
            <div class="user-profile" id="userProfile">
                <img src="../assets/icons/user_icon.png" alt="img" />
                <div class="user-details">
                    <span class="username">Dion Fernando</span>
                    <div class="genius-level">Genius Level 1</div>
                </div>
            </div>
        </div>
    </div>
</header>
<section class="after-header">
    <h2 class="your-lists-h2">Your Lists</h2>
    <div class="description">
        Manage and view all your listed vehicles and properties effortlessly.
    </div>
</section>

<!-- Main Content -->
<div class="container">
    <!-- Vehicles Section -->
    <section id="vehiclesSection">
        <div class="section-title">
            <img src="../assets/icons/car2.png" alt="Vehicle Icon">
            Vehicles
        </div>
        <!-- Listings Container: Vehicles will be injected here -->
        <div id="vehiclesList"></div>
        <!-- Placeholder if no vehicles are listed -->
        <div class="placeholder" id="noVehiclesMessage">
            You have not listed any vehicles yet. <br>
            <a class="cta-button" href="vehicle_add_1.html">List Your Vehicle</a>
        </div>
    </section>

    <!-- Properties Section -->
    <section id="propertiesSection">
        <div class="section-title">
            <img src="../assets/icons/property.png" alt="Property Icon">
            Properties
        </div>
        <!-- Listings Container: Properties will be injected here -->
        <div id="propertiesList"></div>
        <!-- Placeholder if no properties are listed -->
        <div class="placeholder" id="noPropertiesMessage">
            You have not listed any properties yet. <br>
            <a class="cta-button" href="list_your_property.html">List Your Property</a>
        </div>
    </section>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Retrieve the JWT token from localStorage
        const token = localStorage.getItem('token');
        if (!token) {
            console.error("No token found. Please log in.");
            return;
        }

        // Fetch vehicles listed by the user
        const vehiclesEndpoint = "http://localhost:8080/vehicles/user";
        fetch(vehiclesEndpoint, {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch vehicles');
                }
                return response.json();
            })
            .then(data => {
                displayVehicles(data);
            })
            .catch(error => {
                console.error('Error fetching vehicles:', error);
            });

        // Fetch properties listed by the user
        const propertiesEndpoint = "http://localhost:8080/api/v1/properties/user";
        fetch(propertiesEndpoint, {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch properties');
                }
                return response.json();
            })
            .then(data => {
                displayProperties(data);
            })
            .catch(error => {
                console.error('Error fetching properties:', error);
            });

        // Function to display vehicles
        function displayVehicles(vehicles) {
            const vehiclesListDiv = document.getElementById('vehiclesList');
            const noVehiclesMessageDiv = document.getElementById('noVehiclesMessage');
            vehiclesListDiv.innerHTML = "";

            if (vehicles.length === 0) {
                noVehiclesMessageDiv.style.display = "block";
            } else {
                noVehiclesMessageDiv.style.display = "none";
                vehicles.forEach(vehicle => {
                    // Create card container
                    const cardDiv = document.createElement("div");
                    cardDiv.className = "list-card";

                    // Image container
                    const imgDiv = document.createElement("div");
                    imgDiv.className = "list-card-img";
                    const imgEl = document.createElement("img");
                    imgEl.src = vehicle.image;
                    imgEl.alt = vehicle.brand;
                    imgDiv.appendChild(imgEl);

                    // Details container with flex column layout
                    const detailsDiv = document.createElement("div");
                    detailsDiv.className = "list-card-details";

                    const heading = document.createElement("h3");
                    heading.textContent = vehicle.brand;
                    detailsDiv.appendChild(heading);

                    const descriptionPara = document.createElement("p");
                    descriptionPara.innerHTML = `<strong>Description:</strong> ${vehicle.description}`;
                    detailsDiv.appendChild(descriptionPara);

                    const seatsPara = document.createElement("p");
                    seatsPara.innerHTML = `<strong>Seats Count:</strong> ${vehicle.seats}`;
                    detailsDiv.appendChild(seatsPara);

                    const colorPara = document.createElement("p");
                    colorPara.innerHTML = `<strong>Color:</strong> ${vehicle.color}`;
                    detailsDiv.appendChild(colorPara);

                    const pricePara = document.createElement("p");
                    pricePara.innerHTML = `<strong>Price for 3 Days:</strong> LKR ${vehicle.priceFor3Days}`;
                    detailsDiv.appendChild(pricePara);

                    // Create the action buttons container that will stick at the bottom
                    const buttonsContainer = document.createElement("div");
                    buttonsContainer.className = "action-buttons";

                    const editButton = document.createElement("a");
                    editButton.className = "edit-button";
                    editButton.href = "edit_vehicle.html?id=" + vehicle.id;
                    editButton.textContent = "Edit";
                    buttonsContainer.appendChild(editButton);

                    const deleteButton = document.createElement("a");
                    deleteButton.className = "delete-button";
                    deleteButton.href = "delete_vehicle.html?id=" + vehicle.id; // Adjust URL as needed
                    deleteButton.textContent = "Delete";
                    buttonsContainer.appendChild(deleteButton);

                    // Append the buttons container at the bottom of details
                    detailsDiv.appendChild(buttonsContainer);

                    // Assemble the card
                    cardDiv.appendChild(imgDiv);
                    cardDiv.appendChild(detailsDiv);
                    vehiclesListDiv.appendChild(cardDiv);
                });
            }
        }

        // Function to display properties
        function displayProperties(properties) {
            const propertiesListDiv = document.getElementById('propertiesList');
            const noPropertiesMessageDiv = document.getElementById('noPropertiesMessage');
            propertiesListDiv.innerHTML = "";

            if (properties.length === 0) {
                noPropertiesMessageDiv.style.display = "block";
            } else {
                noPropertiesMessageDiv.style.display = "none";
                properties.forEach(property => {
                    const cardDiv = document.createElement("div");
                    cardDiv.className = "list-card";

                    const imgDiv = document.createElement("div");
                    imgDiv.className = "list-card-img";
                    const imgEl = document.createElement("img");
                    if (!property.image.startsWith("data:image/")) {
                        imgEl.src = "data:image/jpeg;base64," + property.image;
                    } else {
                        imgEl.src = property.image;
                    }
                    imgEl.alt = property.name;
                    imgDiv.appendChild(imgEl);

                    const detailsDiv = document.createElement("div");
                    detailsDiv.className = "list-card-details";

                    const heading = document.createElement("h3");
                    heading.textContent = property.name;
                    detailsDiv.appendChild(heading);

                    const descriptionPara = document.createElement("p");
                    descriptionPara.innerHTML = `<strong>Description:</strong> ${property.description}`;
                    detailsDiv.appendChild(descriptionPara);

                    const addressPara = document.createElement("p");
                    addressPara.innerHTML = `<strong>Address:</strong> ${property.address}`;
                    detailsDiv.appendChild(addressPara);

                    const pricePara = document.createElement("p");
                    pricePara.innerHTML = `<strong>Price (Per Day):</strong> LKR ${property.price}`;
                    detailsDiv.appendChild(pricePara);

                    const buttonsContainer = document.createElement("div");
                    buttonsContainer.className = "action-buttons";

                    const editButton = document.createElement("a");
                    editButton.className = "edit-button";
                    editButton.href = "edit_property.html?id=" + property.id;
                    editButton.textContent = "Edit";
                    buttonsContainer.appendChild(editButton);

                    const deleteButton = document.createElement("a");
                    deleteButton.className = "delete-button";
                    deleteButton.href = "delete_property.html?id=" + property.id; // Adjust URL as needed
                    deleteButton.textContent = "Delete";
                    buttonsContainer.appendChild(deleteButton);

                    detailsDiv.appendChild(buttonsContainer);

                    cardDiv.appendChild(imgDiv);
                    cardDiv.appendChild(detailsDiv);
                    propertiesListDiv.appendChild(cardDiv);
                });
            }
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const storedName = localStorage.getItem('name');
        if (storedName) {
            document.querySelectorAll('.username').forEach(el => {
                el.textContent = storedName;
            });
        }
    });
</script>
</body>
</html>
